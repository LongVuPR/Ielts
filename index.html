<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IELTS Speaking Examiner (Custom Questions)</title>
  <style>
    body{font-family:Arial, sans-serif; margin:0; padding:0; background:#f7f7f7; color:#333;}
    header{background:#0056b3; color:white; padding:10px; text-align:center;}
    main{padding:20px; max-width:800px; margin:auto;}
    section{background:white; padding:15px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    label{display:block; margin-top:10px;}
    textarea,input{width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px;}
    button{padding:10px 15px; margin-top:10px; border:none; border-radius:4px; background:#0056b3; color:white; cursor:pointer;}
    button:disabled{background:#aaa;}
  </style>
</head>
<body>
<header>
  <h1>üé§ IELTS Speaking Examiner</h1>
</header>
<main>
  <section id="setup">
    <h2>Nh·∫≠p ƒë·ªÅ thi c·ªßa b·∫°n</h2>
    <label>Part 1 ‚Äì Nh·∫≠p t·ª´ng c√¢u h·ªèi (m·ªói c√¢u m·ªôt d√≤ng)</label>
    <textarea id="part1q" placeholder="C√¢u 1\nC√¢u 2\nC√¢u 3..."></textarea>

    <label>Part 2 ‚Äì Cue card (ti√™u ƒë·ªÅ)</label>
    <input id="part2title" placeholder="Describe a book you recently read..." />
    <label>G·ª£i √Ω (m·ªói d√≤ng m·ªôt √Ω)</label>
    <textarea id="part2cues" placeholder="You should say:\n- what it is about\n- when you read it\n..."></textarea>

    <label>Part 3 ‚Äì Nh·∫≠p t·ª´ng c√¢u h·ªèi (m·ªói c√¢u m·ªôt d√≤ng)</label>
    <textarea id="part3q" placeholder="C√¢u 1\nC√¢u 2\nC√¢u 3..."></textarea>

    <button id="startBtn">B·∫Øt ƒë·∫ßu ph·ªèng v·∫•n</button>
  </section>

  <section id="exam" style="display:none;">
    <h2 id="stageTitle">Part 1</h2>
    <p id="questionText"></p>
    <button id="recBtn">üéôÔ∏è Ghi √¢m</button>
    <button id="stopBtn" disabled>‚èπÔ∏è D·ª´ng</button>
    <button id="nextBtn" disabled>‚û°Ô∏è C√¢u ti·∫øp</button>
    <audio id="player" controls style="display:none;"></audio>
  </section>
</main>
<script>
let stage=1, qIndex=0, questions={p1:[], p2:[], p3:[]};
let rec, stream, chunks=[];

function startExam(){
  questions.p1 = document.getElementById('part1q').value.trim().split(/\n+/);
  questions.p2 = [{ cue: document.getElementById('part2title').value, cues: document.getElementById('part2cues').value.trim().split(/\n+/) }];
  questions.p3 = document.getElementById('part3q').value.trim().split(/\n+/);
  stage=1; qIndex=0;
  document.getElementById('setup').style.display='none';
  document.getElementById('exam').style.display='block';
  showQuestion();
}

function showQuestion(){
  let qList = stage===1?questions.p1:stage===2?questions.p2:questions.p3;
  if(qIndex>=qList.length){
    if(stage===1){ stage=2; qIndex=0; document.getElementById('stageTitle').innerText='Part 2'; showPart2(); return; }
    if(stage===2){ stage=3; qIndex=0; document.getElementById('stageTitle').innerText='Part 3'; showQuestion(); return; }
    if(stage===3){ alert('Ho√†n th√†nh ph·ªèng v·∫•n'); return; }
  }
  document.getElementById('stageTitle').innerText = stage===1? 'Part 1': 'Part 3';
  document.getElementById('questionText').innerText = qList[qIndex].cue || qList[qIndex];
}

function showPart2(){
  let item = questions.p2[0];
  document.getElementById('questionText').innerHTML = `<b>${item.cue}</b><br><ul>${item.cues.map(c=>`<li>${c}</li>`).join('')}</ul>`;
}

document.getElementById('startBtn').onclick=startExam;
document.getElementById('recBtn').onclick=async()=>{
  stream = await navigator.mediaDevices.getUserMedia({audio:true});
  rec = new MediaRecorder(stream);
  chunks=[];
  rec.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
  rec.onstop=()=>{
    let blob = new Blob(chunks, {type:'audio/webm'});
    let url = URL.createObjectURL(blob);
    document.getElementById('player').src=url;
    document.getElementById('player').style.display='block';
  };
  rec.start();
  document.getElementById('recBtn').disabled=true;
  document.getElementById('stopBtn').disabled=false;
};
document.getElementById('stopBtn').onclick=()=>{
  rec.stop();
  document.getElementById('stopBtn').disabled=true;
  document.getElementById('nextBtn').disabled=false;
};
document.getElementById('nextBtn').onclick=()=>{
  qIndex++;
  document.getElementById('nextBtn').disabled=true;
  document.getElementById('recBtn').disabled=false;
  showQuestion();
};
</script>
</body>
</html>
